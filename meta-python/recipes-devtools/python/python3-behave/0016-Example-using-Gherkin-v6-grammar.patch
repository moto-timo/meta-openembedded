From d04672eb94dbdec44343eeabe0400ddb592d8e65 Mon Sep 17 00:00:00 2001
From: jenisys <jenisys@users.noreply.github.com>
Date: Sat, 8 Jun 2019 20:16:01 +0200
Subject: [PATCH] Example using Gherkin v6 grammar.

---
 examples/gherkin_v6/README.rst                | 18 ++++++++
 examples/gherkin_v6/behave.ini                | 42 +++++++++++++++++++
 examples/gherkin_v6/features/rule_1.feature   | 42 +++++++++++++++++++
 examples/gherkin_v6/features/rule_2.feature   | 42 +++++++++++++++++++
 .../features/steps/example_steps.py           | 21 ++++++++++
 .../gherkin_v6/features/steps/person_steps.py |  7 ++++
 6 files changed, 172 insertions(+)
 create mode 100644 examples/gherkin_v6/README.rst
 create mode 100644 examples/gherkin_v6/behave.ini
 create mode 100644 examples/gherkin_v6/features/rule_1.feature
 create mode 100644 examples/gherkin_v6/features/rule_2.feature
 create mode 100644 examples/gherkin_v6/features/steps/example_steps.py
 create mode 100644 examples/gherkin_v6/features/steps/person_steps.py

diff --git a/examples/gherkin_v6/README.rst b/examples/gherkin_v6/README.rst
new file mode 100644
index 0000000..58199dd
--- /dev/null
+++ b/examples/gherkin_v6/README.rst
@@ -0,0 +1,18 @@
+Gherkin v6 Examples
+=============================================================================
+
+
+SCRATCHPAD: Problems
+-----------------------------------------------------------------------------
+
+- SummaryReporter: Shows wrong counts when Rules are present::
+
+    ...
+    0 features passed, 0 failed, 1 skipped XXX
+    3 rules passed, 0 failed, 0 skipped
+    5 scenarios passed, 0 failed, 0 skipped
+    13 steps passed, 0 failed, 0 skipped, 0 undefined
+
+
+- Formatters: PrettyFormatter, PlainFormatter (at least) need Rule support
+
diff --git a/examples/gherkin_v6/behave.ini b/examples/gherkin_v6/behave.ini
new file mode 100644
index 0000000..45c0f0d
--- /dev/null
+++ b/examples/gherkin_v6/behave.ini
@@ -0,0 +1,42 @@
+# =============================================================================
+# BEHAVE CONFIGURATION
+# =============================================================================
+# FILE: .behaverc, behave.ini, setup.cfg, tox.ini
+#
+# SEE ALSO:
+#  * http://packages.python.org/behave/behave.html#configuration-files
+#  * https://github.com/behave/behave
+#  * http://pypi.python.org/pypi/behave/
+# =============================================================================
+
+[behave]
+default_tags = not (@xfail or @not_implemented)
+show_skipped = false
+format   = rerun
+    progress3
+outfiles = rerun.txt
+    reports/report_progress3.txt
+junit = true
+logging_level = INFO
+# logging_format = LOG.%(levelname)-8s  %(name)-10s: %(message)s
+# logging_format = LOG.%(levelname)-8s  %(asctime)s  %(name)-10s: %(message)s
+
+# -- ALLURE-FORMATTER REQUIRES:
+# brew install allure
+# pip install allure-behave
+# ALLURE_REPORTS_DIR=allure.reports
+# behave -f allure -o $ALLURE_REPORTS_DIR ...
+# allure serve $ALLURE_REPORTS_DIR
+#
+# SEE ALSO:
+# * https://github.com/allure-framework/allure2
+# * https://github.com/allure-framework/allure-python
+[behave.formatters]
+allure = allure_behave.formatter:AllureFormatter
+
+# PREPARED:
+#  [behave]
+#  format = ... missing_steps ...
+#  output = ... features/steps/missing_steps.py ...
+#  [behave.formatters]
+#  missing_steps = behave.contrib.formatter_missing_steps:MissingStepsFormatter
diff --git a/examples/gherkin_v6/features/rule_1.feature b/examples/gherkin_v6/features/rule_1.feature
new file mode 100644
index 0000000..a802e19
--- /dev/null
+++ b/examples/gherkin_v6/features/rule_1.feature
@@ -0,0 +1,42 @@
+Feature: Gherkin v6 Example -- with Rules
+  Feature description line 1.
+
+  Background: Feature.Background
+    Given feature background step_1
+
+  Rule: R1 (with Rule.Background)
+    Rule R1 description line 1.
+
+    Background: R1.Background
+      Given rule R1 background step_1
+      When  rule R1 background step_2
+
+    Example: R1.Scenario_1
+      When rule R1 scenario_1 step_1
+      Then rule R1 scenario_1 step_2
+
+    Example: R1.Scenario_2
+      Given rule R1 scenario_2 step_1
+      Then  rule R1 scenario_2 step_2
+
+  Rule: R2 (without Rule.Background)
+    Rule R2 description line 1.
+
+    Example: R2.Scenario_1
+      When rule R2 scenario_1 step_1
+      Then rule R2 scenario_1 step_2
+
+
+  Rule: R3 (with empty Rule.Background)
+    Rule R3 description line 1.
+    Rule R3 description line 2.
+
+    Background: R3.EmptyBackground
+
+    Scenario Template: R3.Scenario
+      Given a person named "<name>"
+
+      Examples:
+        | name  |
+        | Alice |
+        | Bob   |
diff --git a/examples/gherkin_v6/features/rule_2.feature b/examples/gherkin_v6/features/rule_2.feature
new file mode 100644
index 0000000..a802e19
--- /dev/null
+++ b/examples/gherkin_v6/features/rule_2.feature
@@ -0,0 +1,42 @@
+Feature: Gherkin v6 Example -- with Rules
+  Feature description line 1.
+
+  Background: Feature.Background
+    Given feature background step_1
+
+  Rule: R1 (with Rule.Background)
+    Rule R1 description line 1.
+
+    Background: R1.Background
+      Given rule R1 background step_1
+      When  rule R1 background step_2
+
+    Example: R1.Scenario_1
+      When rule R1 scenario_1 step_1
+      Then rule R1 scenario_1 step_2
+
+    Example: R1.Scenario_2
+      Given rule R1 scenario_2 step_1
+      Then  rule R1 scenario_2 step_2
+
+  Rule: R2 (without Rule.Background)
+    Rule R2 description line 1.
+
+    Example: R2.Scenario_1
+      When rule R2 scenario_1 step_1
+      Then rule R2 scenario_1 step_2
+
+
+  Rule: R3 (with empty Rule.Background)
+    Rule R3 description line 1.
+    Rule R3 description line 2.
+
+    Background: R3.EmptyBackground
+
+    Scenario Template: R3.Scenario
+      Given a person named "<name>"
+
+      Examples:
+        | name  |
+        | Alice |
+        | Bob   |
diff --git a/examples/gherkin_v6/features/steps/example_steps.py b/examples/gherkin_v6/features/steps/example_steps.py
new file mode 100644
index 0000000..f4822f3
--- /dev/null
+++ b/examples/gherkin_v6/features/steps/example_steps.py
@@ -0,0 +1,21 @@
+# -*- coding: UTF-8 -*-
+from __future__ import absolute_import, print_function
+from behave import step
+
+
+@step(u'feature background step_{step_id:d}')
+def step_rule_background(ctx, step_id):
+    print("feature background step_{0}".format(step_id))
+
+
+@step(u'rule {rule_id:w} background step_{step_id:d}')
+def step_rule_background(ctx, rule_id, step_id):
+    print("rule {0} background step_{1}".format(rule_id, step_id))
+
+
+@step(u'rule {rule_id:w} scenario_{scenario_id:d} step_{step_id:d}')
+def step_rule_scenario(ctx, rule_id, scenario_id, step_id):
+    print("rule {0} scenario_{1} step_{2}".format(
+        rule_id, scenario_id, step_id))
+
+
diff --git a/examples/gherkin_v6/features/steps/person_steps.py b/examples/gherkin_v6/features/steps/person_steps.py
new file mode 100644
index 0000000..714ac01
--- /dev/null
+++ b/examples/gherkin_v6/features/steps/person_steps.py
@@ -0,0 +1,7 @@
+# -*- coding: UTF-8 -*-
+from behave import given
+
+
+@given(u'a person named "{name}"')
+def step_given_person_with_name(ctx, name):
+    pass
